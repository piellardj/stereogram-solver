!function(){"use strict";var e={350:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.InputImage=void 0,n(457);var a=function(){function e(){var e=this;this.onChangeObservers=[],this.container=document.createElement("section"),this.container.id="input-section",this.container.classList.add("contents-section"),this.presetSelect=function(e){function t(e,t){var n=document.createElement("option");return n.value=e,n.label=t,n}var n=document.createElement("select"),a=t("","Choose a preset");a.disabled=!0,a.hidden=!0,n.appendChild(a);for(var i=0,s=[{value:"shark.jpg",label:"Shark"},{value:"thumbsup.jpg",label:"Thumbs up"},{value:"planet.jpg",label:"Planet"},{value:"dolphins.jpg",label:"Dolphins"},{value:"atomium.jpg",label:"Atomium"}];i<s.length;i++){var o=s[i];n.appendChild(t(o.value,o.label))}return n}(),this.presetSelect.id="preset-select",this.presetSelect.addEventListener("change",(function(){e.onPresetChange()}));var t=document.createElement("div");t.classList.add("input-row");var n=document.createElement("label");n.htmlFor=this.presetSelect.id,n.textContent="Choose a preset: ",t.appendChild(n),t.appendChild(this.presetSelect),this.container.appendChild(t),this.uploadFileButton=document.createElement("input"),this.uploadFileButton.id="image-upload";var a=document.createElement("div");a.classList.add("input-row"),(i=document.createElement("label")).htmlFor=this.uploadFileButton.id,i.textContent="Choose from your computer: ",a.appendChild(i),this.uploadFileButton.type="file",this.uploadFileButton.accept=".png,.jpg,.bmp,.webp",this.uploadFileButton.addEventListener("change",(function(t){t.stopPropagation();var n=e.uploadFileButton.files;if(1===n.length){var a=new FileReader;a.onload=function(){var t=new Image;t.addEventListener("load",(function(){e.loadedImage=t,e.presetSelect.value="",e.callObservers()})),t.src=a.result},a.readAsDataURL(n[0])}}),!1),a.appendChild(this.uploadFileButton),this.container.appendChild(a),this.urlInput=document.createElement("input"),this.urlInput.id="url-input";var i,s=document.createElement("div");s.classList.add("input-row"),(i=document.createElement("label")).htmlFor=this.urlInput.id,i.textContent="Choose from the Internet: ",s.appendChild(i);var o=document.createElement("div");this.urlInput.type="text",this.urlInput.placeholder="Image url...",o.appendChild(this.urlInput),this.urlLoadButton=document.createElement("button"),this.urlLoadButton.textContent="Load from URL",o.appendChild(this.urlLoadButton),this.urlLoadButton.addEventListener("click",(function(){e.loadImage(e.urlInput.value),e.presetSelect.value="",e.uploadFileButton.value=""})),s.appendChild(o),this.container.appendChild(s),this.onPresetChange()}return Object.defineProperty(e.prototype,"image",{get:function(){return this.loadedImage},enumerable:!1,configurable:!0}),e.prototype.onPresetChange=function(){var e=this.presetSelect.value;if(e){var t="resources/images/"+e+"?v="+Page.version;this.loadImage(t),this.uploadFileButton.value=""}},e.prototype.loadImage=function(e){var t=this,n=new Image;n.addEventListener("load",(function(){t.loadedImage=n,t.callObservers()})),n.addEventListener("error",(function(){!function(e){var t="IMAGE_FAILED_TO_LOAD",n=document.getElementById(t);if(!n){var a=document.getElementById("errors");(n=document.createElement("div")).id=t,a.appendChild(n)}n.textContent="Failed to load image from url: '"+e+"'."}(e)})),n.src=e},e.prototype.callObservers=function(){for(var e=0,t=this.onChangeObservers;e<t.length;e++)(0,t[e])()},e}();t.InputImage=a},457:function(){},685:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Processing=void 0;var n=function(){function e(){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d")}return e.prototype.detectBasePeriod=function(t){this.canvas.width=t.width,this.canvas.height=t.height,this.context.drawImage(t,0,0);for(var n=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),a=function(){for(var e=[],t=n.height<50?1:n.height/50,a=0;a<n.height;a+=t)e.push(Math.floor(a));return e}(),i=n.width/3,s=[],o=e.MIN_DISPLACEMENT_ALLOWED;o<=i;o++){for(var d=0,l=0,r=a;l<r.length;l++)for(var c=r[l],h=o;h<n.width;h++){var p=4*(h+c*n.width),u=p-4*o,m=n.data[p]-n.data[u],v=n.data[p+1]-n.data[u+1],g=n.data[p+2]-n.data[u+2];d+=(Math.abs(m)+Math.abs(v)+Math.abs(g))/3}var f=d/(a.length*(n.width-o));s.push(f)}return this.computeBestDisplacement(s)+e.MIN_DISPLACEMENT_ALLOWED},e.prototype.computeBestDisplacement=function(e){for(var t=1,n=-1,a=2;a<e.length-1;a++){var i=e[a+1]-e[a];i>n&&(t=a,n=i)}for(a=0;a<3;a++)t>0&&e[t-1]<e[t]&&t--;return t},e.MIN_DISPLACEMENT_ALLOWED=10,e}();t.Processing=n},720:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Visualization=void 0;var n=function(){function e(){var e=this;this._displacement=1,this.container=document.createElement("section"),this.container.classList.add("contents-section");var t=document.createElement("div"),n=document.createElement("div");n.appendChild(document.createTextNode("Image size: ")),this.textOutputImageSize=document.createElement("span"),n.appendChild(this.textOutputImageSize),t.appendChild(n);var a=document.createElement("div");a.appendChild(document.createTextNode("Displacement: ")),this.textOuputDisplacement=document.createElement("span"),a.appendChild(this.textOuputDisplacement),t.appendChild(a),this.container.appendChild(t),this.displacementRange=document.createElement("input"),this.displacementRange.classList.add("full-width-range"),this.displacementRange.type="range",this.displacementRange.min="0",this.displacementRange.max="100",this.displacementRange.step="1",this.displacementRange.value="1";var i=function(){e.displacement=+e.displacementRange.value};this.displacementRange.addEventListener("change",i),this.displacementRange.addEventListener("input",i),this.container.appendChild(this.displacementRange),this.canvasElement=document.createElement("canvas"),this.canvasElement.style.maxWidth="100%",this.canvasElement.width=100,this.canvasElement.height=100,this.container.appendChild(this.canvasElement),this.canvasContext=this.canvasElement.getContext("2d")}return Object.defineProperty(e.prototype,"image",{set:function(e){this._image=e,this.canvasElement.width=this._image.width,this.canvasElement.height=this._image.height,this.displacementRange.max=this.canvasElement.width.toFixed(0),this.textOutputImageSize.textContent=this._image.width+"x"+this._image.height,this.update()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"displacement",{set:function(e){this._displacement=e,this.displacementRange.value=e.toFixed(0),this.textOuputDisplacement.textContent=e.toFixed(0)+"px",this.update()},enumerable:!1,configurable:!0}),e.prototype.update=function(){this._image&&(this.canvasContext.globalCompositeOperation="source-over",this.canvasContext.drawImage(this._image,0,0,this.canvasElement.width,this.canvasElement.height),this._displacement>0&&(this.canvasContext.globalCompositeOperation="difference","difference"!==this.canvasContext.globalCompositeOperation&&function(){var e="COMPOSITING_ERROR";if(!document.getElementById(e)){var t=document.getElementById("errors"),n=document.createElement("div");n.id=e,n.textContent="Your browser does not support the 'difference' globalCompositeOperation. This project will not run as expected.",t.appendChild(n)}}(),this.canvasContext.drawImage(this._image,this._displacement,0,this.canvasElement.width,this.canvasElement.height)))},e}();t.Visualization=n}},t={};function n(a){var i=t[a];if(void 0!==i)return i.exports;var s=t[a]={exports:{}};return e[a](s,s.exports,n),s.exports}!function(){var e,t=n(350),a=n(685),i=n(720),s=document.getElementById("contents"),o=new t.InputImage,d=new i.Visualization,l=new a.Processing;s.appendChild(o.container),s.appendChild(d.container);var r=document.createElement("section");r.classList.add("contents-section");var c=document.createElement("div");function h(){var t=o.image;t&&(d.image=t,d.displacement=l.detectBasePeriod(t),e&&e.parentElement.removeChild(e),(e=t).style.maxWidth="100%",r.appendChild(e))}c.textContent="Source image:",r.appendChild(c),r.appendChild(c),s.appendChild(r),o.onChangeObservers.push(h),h()}()}();
//# sourceMappingURL=main.min.js.map