{"version":3,"file":"main.min.js","mappings":"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","sources":["webpack://stereogram-solver/./src/ts/input-image.ts","webpack://stereogram-solver/./src/ts/processing.ts","webpack://stereogram-solver/./src/ts/visualization.ts","webpack://stereogram-solver/webpack/bootstrap","webpack://stereogram-solver/./src/ts/main.ts"],"sourcesContent":["import \"./page-interface-generated\"\n\n\nfunction setFailedToLoadError(url: string | null): void {\n    const id = \"IMAGE_FAILED_TO_LOAD\";\n\n    let div = document.getElementById(id);\n    if (!div) {\n        const errorsSection = document.getElementById(\"errors\");\n        div = document.createElement(\"div\");\n        div.id = id;\n        errorsSection.appendChild(div);\n    }\n\n    if (url === null) {\n        div.style.display = \"none\";\n    } else {\n        div.style.display = \"\";\n        div.textContent = `Failed to load image from url: '${url}'.`;\n    }\n}\n\ntype Observer = () => unknown;\n\ninterface ISelectOption {\n    value: string;\n    label: string;\n}\n\nconst SELECT_DEFAULT_VALUE = \"\";\n\nfunction buildSelect(options: ISelectOption[]): HTMLSelectElement {\n    function buildOption(value: string, label: string): HTMLOptionElement {\n        const option = document.createElement(\"option\");\n        option.value = value;\n        option.label = label;\n        return option;\n    }\n\n    const select = document.createElement(\"select\");\n    const defaultOption = buildOption(SELECT_DEFAULT_VALUE, \"Choose a preset\");\n    defaultOption.disabled = true;\n    defaultOption.hidden = true;\n    select.appendChild(defaultOption);\n    for (const option of options) {\n        select.appendChild(buildOption(option.value, option.label));\n    }\n\n    return select;\n}\n\nclass InputImage {\n    public readonly onChangeObservers: Observer[] = [];\n\n    public readonly container: HTMLElement;\n\n    private readonly presetSelect: HTMLSelectElement;\n    private readonly uploadFileButton: HTMLInputElement;\n    private readonly urlInput: HTMLInputElement;\n    private readonly urlLoadButton: HTMLButtonElement;\n\n    private loadedImage: HTMLImageElement;\n\n    public constructor() {\n        this.container = document.createElement(\"section\");\n        this.container.id = \"input-section\";\n        this.container.classList.add(\"contents-section\");\n\n        {\n            this.presetSelect = buildSelect([\n                { value: \"shark.jpg\", label: \"Shark\" },\n                { value: \"thumbsup.jpg\", label: \"Thumbs up\" },\n                { value: \"planet.jpg\", label: \"Planet\" },\n                { value: \"dolphins.jpg\", label: \"Dolphins\" },\n                { value: \"atomium.jpg\", label: \"Atomium\" },\n            ]);\n            this.presetSelect.id = \"preset-select\";\n            this.presetSelect.addEventListener(\"change\", () => { this.onPresetChange(); });\n\n            const presetContainer = document.createElement(\"div\");\n            presetContainer.classList.add(\"input-row\");\n            const presetLabel = document.createElement(\"label\");\n            presetLabel.htmlFor = this.presetSelect.id;\n            presetLabel.textContent = \"Choose a preset: \";\n\n            presetContainer.appendChild(presetLabel);\n            presetContainer.appendChild(this.presetSelect);\n\n            this.container.appendChild(presetContainer);\n        }\n\n        {\n            this.uploadFileButton = document.createElement(\"input\");\n            this.uploadFileButton.id = \"image-upload\";\n\n            const fileInputContainer = document.createElement(\"div\");\n            fileInputContainer.classList.add(\"input-row\");\n            const label = document.createElement(\"label\");\n            label.htmlFor = this.uploadFileButton.id;\n            label.textContent = \"Choose from your computer: \";\n            fileInputContainer.appendChild(label);\n\n            this.uploadFileButton.type = \"file\";\n            this.uploadFileButton.accept = \".png,.jpg,.jpeg,.bmp,.webp\";\n            this.uploadFileButton.addEventListener(\"change\", (event: Event) => {\n                event.stopPropagation();\n                const files = this.uploadFileButton.files;\n                if (files.length === 1) {\n                    const reader = new FileReader();\n                    reader.onload = () => {\n                        const image = new Image();\n                        image.addEventListener(\"load\", () => {\n                            this.loadedImage = image;\n                            this.presetSelect.value = SELECT_DEFAULT_VALUE;\n                            this.callObservers();\n                        });\n                        image.src = reader.result as string;\n                    };\n                    reader.readAsDataURL(files[0]);\n                }\n            }, false);\n\n            fileInputContainer.appendChild(this.uploadFileButton);\n            this.container.appendChild(fileInputContainer);\n        }\n\n        {\n            this.urlInput = document.createElement(\"input\");\n            this.urlInput.id = \"url-input\";\n\n            const urlInputContainer = document.createElement(\"div\");\n            urlInputContainer.classList.add(\"input-row\");\n            const label = document.createElement(\"label\");\n            label.htmlFor = this.urlInput.id;\n            label.textContent = \"Choose from the Internet: \";\n            urlInputContainer.appendChild(label);\n\n            const inputContainer = document.createElement(\"div\");\n            this.urlInput.type = \"text\";\n            this.urlInput.placeholder = \"Image url...\";\n            inputContainer.appendChild(this.urlInput);\n\n            this.urlLoadButton = document.createElement(\"button\");\n            this.urlLoadButton.textContent = \"Load from URL\";\n            inputContainer.appendChild(this.urlLoadButton);\n\n            this.urlLoadButton.addEventListener(\"click\", () => {\n                this.loadCrossOriginImage(this.urlInput.value);\n                this.presetSelect.value = SELECT_DEFAULT_VALUE;\n                this.uploadFileButton.value = \"\";\n            })\n\n            urlInputContainer.appendChild(inputContainer);\n            // this.container.appendChild(urlInputContainer);\n        }\n\n        this.onPresetChange();\n    }\n\n    public get image(): HTMLImageElement {\n        return this.loadedImage;\n    }\n\n    private onPresetChange(): void {\n        const preset = this.presetSelect.value;\n        if (preset) {\n            const url = `resources/images/${preset}?v=${Page.version}`;\n            this.loadImage(url);\n            this.uploadFileButton.value = \"\";\n        }\n    }\n\n    private loadImage(url: string): void {\n        const startingImage = new Image();\n        startingImage.addEventListener(\"load\", () => {\n            setFailedToLoadError(null);\n\n            this.loadedImage = startingImage;\n            this.callObservers();\n        });\n        startingImage.addEventListener(\"error\", () => {\n            setFailedToLoadError(url);\n        });\n        startingImage.src = url;\n    }\n\n    private loadCrossOriginImage(url: string): void {\n        // Loading and manipulating a cross origin image is tricky\n        // because canvas2d APIs such as getImageData() are blocked when the canvas is tainted by a cross origin image\n\n        // use XMLHttpRequest and not Image directly because I ant to set custom headers\n        const xhr = new XMLHttpRequest();\n        xhr.addEventListener(\"load\", () => {\n            const reader = new FileReader();\n            reader.addEventListener(\"loadend\", () => {\n                // pass a data url because it does not contain information that the data is cross-origin\n                // so the canvas won't be tainted\n                this.loadImage(reader.result.toString());\n            });\n            reader.readAsDataURL(xhr.response);\n        });\n\n        // use a proxy that allows all cross origin\n        xhr.open('GET', `https://cors-anywhere.herokuapp.com/${url}`);\n        // set this header because the proxy requires it\n        xhr.setRequestHeader(\"X-Request-URL\", \"null\");\n\n        // request data in the data-url form so that it can be later parsed as an image\n        xhr.responseType = 'blob';\n        xhr.send();\n    }\n\n    private callObservers(): void {\n        for (const observer of this.onChangeObservers) {\n            observer();\n        }\n    }\n}\n\nexport {\n    InputImage,\n};\n","\n\nclass Processing {\n    private readonly canvas: HTMLCanvasElement;\n    private readonly context: CanvasRenderingContext2D;\n\n    private static readonly MIN_DISPLACEMENT_ALLOWED = 10;\n\n    public constructor() {\n        this.canvas = document.createElement(\"canvas\");\n        this.context = this.canvas.getContext(\"2d\");\n    }\n\n    public detectBasePeriod(image: HTMLImageElement): number {\n        this.canvas.width = image.width;\n        this.canvas.height = image.height;\n        this.context.drawImage(image, 0, 0);\n        const imageData = this.context.getImageData(0, 0, this.canvas.width, this.canvas.height);\n\n        const MAX_TESTED_LINES_COUNT = 50;\n        const computeTestedLines = (): number[] => {\n            const result: number[] = [];\n            const delta = (imageData.height < MAX_TESTED_LINES_COUNT) ? 1 : (imageData.height / MAX_TESTED_LINES_COUNT);\n            for (let i = 0; i < imageData.height; i += delta) {\n                result.push(Math.floor(i));\n            }\n            return result;\n        };\n\n        const testedLines = computeTestedLines();\n\n        const MAX_DISPLACEMENT_ALLOWED = imageData.width / 3;\n\n        const differences = []; // displacement=0 is considered as unavailable so set a high value for it\n\n        for (let displacement = Processing.MIN_DISPLACEMENT_ALLOWED; displacement <= MAX_DISPLACEMENT_ALLOWED; displacement++) {\n            let totalDifference = 0;\n            for (const iY of testedLines) {\n                for (let iX = displacement; iX < imageData.width; iX++) {\n                    const baseIndex = 4 * (iX + iY * imageData.width);\n                    const targetIndex = baseIndex - 4 * displacement;\n\n                    const dRed = imageData.data[baseIndex] - imageData.data[targetIndex];\n                    const dGreen = imageData.data[baseIndex + 1] - imageData.data[targetIndex + 1];\n                    const dBlue = imageData.data[baseIndex + 2] - imageData.data[targetIndex + 2];\n\n                    const difference = (Math.abs(dRed) + Math.abs(dGreen) + Math.abs(dBlue)) / 3;\n                    totalDifference += difference;\n                }\n            }\n\n            const nbPixels = (testedLines.length * (imageData.width - displacement));\n            const averageDifference = totalDifference / nbPixels;\n            differences.push(averageDifference);\n        }\n\n        const bestDisplacement = this.computeBestDisplacement(differences) + Processing.MIN_DISPLACEMENT_ALLOWED;\n        return bestDisplacement;\n    }\n\n    private computeBestDisplacement(differences: number[]): number {\n        // when reaching the correct delta, on most stereograms the total difference is at its lowest, and goes right up just after\n        // so try to detect this point\n        let highestGradientIndex = 1;\n        let highestGradient = -1;\n        for (let i = 2; i < differences.length - 1; i++) {\n            const gradient = differences[i + 1] - differences[i];\n\n            // console.log(`${i + Processing.MIN_DISPLACEMENT_ALLOWED}:\\t${differences[i]}\\t${gradient}`);\n            if (gradient > highestGradient) {\n                highestGradientIndex = i;\n                highestGradient = gradient;\n            }\n        }\n\n        // The gradient helps determine the end of the lowest plateau.\n        // Once found, check what was just before because maybe it was better\n        for (let i = 0; i < 3; i++) {\n            if (highestGradientIndex > 0 && differences[highestGradientIndex - 1] < differences[highestGradientIndex]) {\n                highestGradientIndex--;\n            }\n        }\n        return highestGradientIndex;\n    }\n}\n\nexport {\n    Processing,\n};\n","function setCompositingError(): void {\n    const id = \"COMPOSITING_ERROR\";\n\n    if (!document.getElementById(id)) {\n        const errorsSection = document.getElementById(\"errors\");\n        const div = document.createElement(\"div\");\n        div.id = id;\n        div.textContent = \"Your browser does not support the 'difference' globalCompositeOperation. This project will not run as expected.\";\n        errorsSection.appendChild(div);\n    }\n\n}\n\nclass Visualization {\n    public readonly container: HTMLElement;\n\n    private readonly displacementRange: HTMLInputElement;\n    private readonly canvasElement: HTMLCanvasElement;\n    private readonly canvasContext: CanvasRenderingContext2D;\n\n    private readonly textOutputImageSize: HTMLSpanElement;\n    private readonly textOuputDisplacement: HTMLSpanElement;\n\n    private _displacement: number = 1;\n    private _image: HTMLImageElement;\n\n    public constructor() {\n        this.container = document.createElement(\"section\");\n        this.container.classList.add(\"contents-section\");\n\n        {\n            const textOutputContainer = document.createElement(\"div\");\n\n            const imageSize = document.createElement(\"div\");\n            imageSize.appendChild(document.createTextNode(\"Image size: \"));\n            this.textOutputImageSize = document.createElement(\"span\");\n            imageSize.appendChild(this.textOutputImageSize);\n            textOutputContainer.appendChild(imageSize);\n\n            const displacement = document.createElement(\"div\");\n            displacement.appendChild(document.createTextNode(\"Displacement: \"));\n            this.textOuputDisplacement = document.createElement(\"span\");\n            displacement.appendChild(this.textOuputDisplacement);\n            textOutputContainer.appendChild(displacement);\n\n            this.container.appendChild(textOutputContainer);\n        }\n\n        {\n            this.displacementRange = document.createElement(\"input\");\n            this.displacementRange.classList.add(\"full-width-range\");\n            this.displacementRange.type = \"range\";\n            this.displacementRange.min = \"0\";\n            this.displacementRange.max = \"100\";\n            this.displacementRange.step = \"1\";\n            this.displacementRange.value = \"1\";\n            const onNewDisplacement = () => {\n                this.displacement = +this.displacementRange.value;\n            };\n            this.displacementRange.addEventListener(\"change\", onNewDisplacement);\n            this.displacementRange.addEventListener(\"input\", onNewDisplacement);\n            this.container.appendChild(this.displacementRange);\n        }\n\n        this.canvasElement = document.createElement(\"canvas\");\n        this.canvasElement.style.maxWidth = \"100%\";\n        this.canvasElement.width = 100;\n        this.canvasElement.height = 100;\n        this.container.appendChild(this.canvasElement);\n\n        this.canvasContext = this.canvasElement.getContext(\"2d\");\n    }\n\n    public set image(image: HTMLImageElement) {\n        this._image = image;\n\n        this.canvasElement.width = this._image.width;\n        this.canvasElement.height = this._image.height;\n\n        this.displacementRange.max = this.canvasElement.width.toFixed(0);\n\n        this.textOutputImageSize.textContent = `${this._image.width}x${this._image.height}`;\n\n        this.update();\n    }\n\n    public set displacement(displacement: number) {\n        this._displacement = displacement;\n        this.displacementRange.value = displacement.toFixed(0);\n\n        this.textOuputDisplacement.textContent = `${displacement.toFixed(0)}px`;\n        this.update();\n    }\n\n    private update(): void {\n        if (this._image) {\n            this.canvasContext.globalCompositeOperation = \"source-over\";\n            this.canvasContext.drawImage(this._image, 0, 0, this.canvasElement.width, this.canvasElement.height);\n\n            if (this._displacement > 0) {\n                this.canvasContext.globalCompositeOperation = \"difference\";\n                if (this.canvasContext.globalCompositeOperation !== \"difference\") {\n                    setCompositingError();\n                }\n\n                this.canvasContext.drawImage(this._image, this._displacement, 0, this.canvasElement.width, this.canvasElement.height);\n            }\n        }\n    }\n}\n\nexport {\n    Visualization,\n};\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","import { InputImage } from \"./input-image\";\nimport { Processing } from \"./processing\";\nimport { Visualization } from \"./visualization\";\n\n\nconst container = document.getElementById(\"contents\");\n\nconst inputImage = new InputImage();\nconst visualization = new Visualization();\nconst processing = new Processing();\n\ncontainer.appendChild(inputImage.container);\ncontainer.appendChild(visualization.container);\n\nlet rawImage: HTMLImageElement;\nconst sourceImageSection = document.createElement(\"section\");\n{\n    sourceImageSection.classList.add(\"contents-section\");\n    const description = document.createElement(\"div\");\n    description.textContent = \"Source image:\";\n    sourceImageSection.appendChild(description);\n    sourceImageSection.appendChild(description);\n    container.appendChild(sourceImageSection);\n}\n\nfunction onNewImage(): void {\n    const image = inputImage.image;\n    if (image) {\n        visualization.image = image;\n        visualization.displacement = processing.detectBasePeriod(image);\n\n        if (rawImage) {\n            rawImage.parentElement.removeChild(rawImage);\n        }\n        rawImage = image;\n        rawImage.style.maxWidth = \"100%\";\n        sourceImageSection.appendChild(rawImage);\n    }\n}\n\ninputImage.onChangeObservers.push(onNewImage);\nonNewImage();\n"],"names":["setFailedToLoadError","url","id","div","document","getElementById","errorsSection","createElement","appendChild","style","display","textContent","onChangeObservers","this","container","classList","add","presetSelect","options","buildOption","value","label","option","select","defaultOption","disabled","hidden","buildSelect","addEventListener","onPresetChange","presetContainer","presetLabel","htmlFor","uploadFileButton","fileInputContainer","type","accept","event","stopPropagation","files","length","FileReader","onload","image","Image","loadedImage","callObservers","src","result","readAsDataURL","urlInput","urlInputContainer","inputContainer","placeholder","urlLoadButton","loadCrossOriginImage","preset","Page","version","loadImage","startingImage","xhr","XMLHttpRequest","reader","toString","response","open","setRequestHeader","responseType","send","observer","InputImage","canvas","context","getContext","detectBasePeriod","width","height","drawImage","imageData","getImageData","testedLines","delta","i","push","Math","floor","computeTestedLines","MAX_DISPLACEMENT_ALLOWED","differences","displacement","Processing","MIN_DISPLACEMENT_ALLOWED","totalDifference","iY","iX","baseIndex","targetIndex","dRed","data","dGreen","dBlue","abs","averageDifference","computeBestDisplacement","highestGradientIndex","highestGradient","gradient","_displacement","textOutputContainer","imageSize","createTextNode","textOutputImageSize","textOuputDisplacement","displacementRange","min","max","step","onNewDisplacement","canvasElement","maxWidth","canvasContext","_image","toFixed","update","globalCompositeOperation","setCompositingError","Visualization","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","exports","module","__webpack_modules__","rawImage","inputImage","visualization","processing","sourceImageSection","description","onNewImage","parentElement","removeChild"],"sourceRoot":""}